---
title: "Final Project Data"
author: "Keeley MacAfee"
date: "11/26/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(janitor)
```

```{r}
#Raw nominal expenditures 
expenditures <- read_excel("nominal_expenditures.xlsx", skip = 4, n_max = 21) %>%
  clean_names()

#Raw expenditures no taxes/tips
expenditures_no_taxes_tips <- read_excel("nominal_expenditures_no_taxes_tips.xlsx", skip = 4, n_max = 21) %>%
  clean_names()

#Yearly population data
population <- read_excel("POPTOTUSA647NWDB.xls") %>%
  slice(38:58) %>%
  mutate(neat = str_split(observation_date, "-")) %>%
  separate(neat, into = c("c", "year", "date1", "date2")) %>%
  select(year, POPTOTUSA647NWDB) %>%
  transmute(year = year, pop = POPTOTUSA647NWDB) %>%
  mutate(year = parse_number(year))

#Join food expenditure data
exp_joined <- left_join(expenditures, expenditures_no_taxes_tips, by = "year") %>%
  select(year, grocery_stores.x, convenience_stores.x, mass_merchandisers.x, mail_order_and_home_delivery.x, home_production_and_donations.x, full_service_restaurants.x, hotels_and_motels.x, schools_and_colleges.x, grocery_stores.y, convenience_stores.y, mass_merchandisers.y, mail_order_and_home_delivery.y, home_production_and_donations.y, full_service_restaurants.y, hotels_and_motels.y, schools_and_colleges.y)

#Calculate tips/taxes each category 
tips_taxes_total <- exp_joined %>%
  mutate(t_grocery = grocery_stores.x - grocery_stores.y,
         t_conv = convenience_stores.x - convenience_stores.y,
         t_mass = mass_merchandisers.x - mass_merchandisers.y,
         t_mail = mail_order_and_home_delivery.x - mail_order_and_home_delivery.y,
         t_home = home_production_and_donations.x - home_production_and_donations.y,
         t_rest = full_service_restaurants.x - full_service_restaurants.y,
         t_hotel = hotels_and_motels.x - hotels_and_motels.y, 
         t_school = schools_and_colleges.x - schools_and_colleges.y)

#Calculate tips/taxes for individuals
indiv_tips_taxes <- left_join(tips_taxes_total, population, by = "year") %>%
  mutate(indiv_t_grocery = (t_grocery/pop) * 1000000,
         indiv_t_conv = (t_conv/pop) * 1000000,
         indiv_t_mass = (t_mass/pop) * 1000000,
         indiv_t_mail = (t_mail/pop) * 1000000,
         indiv_t_home = t_home/pop,
         indiv_t_rest = (t_rest/pop) * 1000000,
         indiv_t_hotel = (t_hotel/pop) * 1000000,
         indiv_t_school = t_school/pop) %>%
  select(year, indiv_t_grocery, indiv_t_conv, indiv_t_mass, indiv_t_mail, indiv_t_home, indiv_t_rest, indiv_t_hotel, indiv_t_school)

ggplot(indiv_tips_taxes, aes(x = year, y = indiv_t_mail)) + geom_point() + geom_smooth()

```



```{r}
#Food 
food <- expenditures %>%
  select(year, grocery_stores, convenience_stores, mass_merchandisers, mail_order_and_home_delivery, home_production_and_donations, full_service_restaurants, hotels_and_motels, schools_and_colleges)

indiv_food <- left_join(food, population, by = "year") %>%
  mutate(indiv_grocery = grocery_stores/pop,
         indiv_conv = convenience_stores/pop,
         indiv_mass = mass_merchandisers/pop,
         indiv_mail = mail_order_and_home_delivery/pop,
         indiv_home = home_production_and_donations/pop,
         indiv_rest = full_service_restaurants/pop,
         indiv_hotel = hotels_and_motels/pop, 
         indiv_school = schools_and_colleges/pop)

food_no_taxes_tips <- expenditures_no_taxes_tips %>%
  select(year, grocery_stores, convenience_stores, mass_merchandisers, mail_order_and_home_delivery, home_production_and_donations, full_service_restaurants, hotels_and_motels, schools_and_colleges)

indiv_food_no_t <- left_join(food_no_taxes_tips, population, by = "year") %>%
  mutate(indiv_grocery = grocery_stores/pop,
         indiv_conv = convenience_stores/pop,
         indiv_mass = mass_merchandisers/pop,
         indiv_mail = mail_order_and_home_delivery/pop,
         indiv_home = home_production_and_donations/pop,
         indiv_rest = full_service_restaurants/pop,
         indiv_hotel = hotels_and_motels/pop, 
         indiv_school = schools_and_colleges/pop)

ggplot(indiv_food_no_t, aes(x = year, y = indiv_mass)) + geom_point() + geom_smooth()
```

```{r}
# Join data
exp_pop <- left_join(expenditures, population, by = "year")

total_indiv <- exp_pop %>%
  mutate(indiv_fah = total_fah/pop,
         indiv_fafh = total_fafh/pop) %>%
  select(year, indiv_fah, indiv_fafh)

```


```{r}
#Example plot
conv <- expenditures %>%
  select(year, convenience_stores)

ggplot(conv, aes(x = year, y = convenience_stores)) + geom_point()
```


```{r}
write_rds(expenditures, path = "final-app/expenditures.rds")

write_rds(expenditures_no_taxes_tips, path = "final-app/expenditures_no_taxes_tips.rds")

write_rds(total_indiv, path = "final-app/total_indiv.rds")

write_rds(food, path = "final-app/food.rds")

write_rds(indiv_tips_taxes, path = "final-app/indiv_tips_taxes.rds")
```


```{r}
# Plot 1 is raw nominal expenditures on certain food places. 
```


